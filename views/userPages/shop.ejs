<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>

  <!----- bootstrap ------>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"">
 
     <!----- font awsome ----->
     <link
       rel=" stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />


  <!----- jQuery form validation ----->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/jquery.validate.min.js"
    integrity="sha512-WMEKGZ7L5LWgaPeJtw9MBM4i5w5OSBlSjTjCtSnvFJGSVD26gE5+Td12qN5pvWXhuWaWcVwF++F7aqu9cvqP0A=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/additional-methods.min.js"
    integrity="sha512-TiQST7x/0aMjgVTcep29gi+q5Lk5gVTUPE9XgN0g96rwtjEjLpod4mlBRKWHeBcvGBAEvJBmfDqh2hfMMmg+5A=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>


  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

  <style>
    .product-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      display: block;
    }

    .wishlist-icon {
      display: inline-block;
      background-color: white;
      color: rgb(46, 41, 41);
      /* Dark color for the icon */
      /* border: 2px solid rgb(46, 41, 41); */
      /* Dark border */
      /* border-radius: 50%; */
      /* Makes the icon circular */
      padding: 5px;
      /* Adds space around the icon */
      text-align: center;
      line-height: 1;
      cursor: pointer;
    }

    .wishlist-icon.active {
      color: red;
      /* Change color to red when active */
    }

    .popup-message {
      display: none;
      /* Hidden by default */
      position: fixed;
      right: 20px;
      top: 20px;
      background-color: black;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .popup-message.show {
      display: block;
      opacity: 1;
    }


    .custom-control-input {
      appearance: none;
      -webkit-appearance: none;
      background-color: #fff;
      border: 2px solid black;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      cursor: pointer;
      position: relative;
    }

    .custom-control-input:checked {
      border-color: black;
      background-color: #295f4e;
      /* Inner color when selected */
    }

    .custom-control-input:checked::before {
      content: '';
      display: block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: black;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .pagination .page-item .page-link.active-page {
      background-color: #a49b9b;
      color: white;
    }

    /*-----*/
    .error {
      color: red;
    }


    @media (max-width: 767.98px) {
      #filterSection {
        display: none;
      }
    }

    /* Default hidden state for small screens */
    @media (max-width: 767.98px) {
      .filter-section {
        display: none;
        width: 100%;
        background-color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        position: absolute;
        z-index: 1000;
      }

      .filter-section.visible {
        display: block;
      }
    }

    


    .full-width-button {
      color: white;
      background-color: #295f4e;
      border: 1px solid #295f4e;
      /* border-radius: 2px; */
      width: 100%;
      /* Makes the button take full width */
      padding: 6px;
      /* Optional: Adds padding inside the button */
      box-sizing: border-box;
      /* Ensures padding and border are included in the width */
    }

    .wishlist-icon,
      .cart-icon {
        position: relative;
        display: inline-block;
      }

      .wishlist-count,
      .cart-count {
        position: absolute;
        top: -4px; /* adjust the position to your liking */
        right: -10px; /* adjust the position to your liking */
        font-size: 10px; /* adjust the font size to your liking */
        background-color: rgb(228, 38, 38); /* adjust the background color to your liking */
        border-radius: 50%; /* make it a circle */
        padding: 4px 9px; /* adjust the padding to your liking */
        color: white; /* adjust the text color to your liking */
        display: flex;
        align-items: center;
        justify-content: center;
      }

  </style>
</head>

<body style="color: white;">

  <!-- header -->
  <header class="sticky-top" style="box-shadow: 0 0 10px rgba(0, 0, 0, 0.1)">
    <!-- Nav bar -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: white; color: black">
      <div class="container">
        <a class="navbar-brand" href="/" style="margin-right: 30px;">
          <h1 style="color: black; font-size: 25px;">Men's Cart</h1>
        </a>
        <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#myNavbar"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <i class="fa-solid fa-bars" style="color: black;"></i>
        </button>

        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item text-center">
              <a href="/" class="nav-link" style="color: black;">Home</a>
            </li>
            <li class="nav-item text-center">
              <a href="/about" class="nav-link" style="color: black">About</a>
            </li>
            <li class="nav-item text-center">
              <a href="/shop" class="nav-link" style="color: black">Shop</a>
            </li>
          </ul>


          <ul class="navbar-nav ms-auto">
            <% if(logged) { %>
              <li class="nav-item text-center mt-2">
                <a href="/userProfile" class="nav-link" style="color: black">
                  <i class="fa-solid fa-user"></i>
                </a>
              </li>

              <li class="nav-item text-center mt-2">
                <a href="/wishlist" class="nav-link wishlist-icon">
                  <i
                    class="fa-regular fa-heart"
                    style="color: black; font-size: 20px"
                  ></i>
                  <span class="wishlist-count"><%= iconData.wishlistCount %></span>
                </a>
              </li>

              <li class="nav-item text-center mt-2">
                <a href="/cart" class="nav-link cart-icon">
                  <i class="fa-solid fa-cart-shopping" style="color: black"></i>
                  <span class="cart-count"><%= iconData.cartCount %></span>
                </a>
              </li>

              <p
                style="
                  margin-top: 7%;
                  margin-left: 23%;
                  margin-right: -6%;
                  font-weight: bolder;
                "
              >
                <%= name %>
              </p>
              <% }else { %>
                <li class="nav-item text-center mt-2" style="margin-left: -38%;">
                  <a href="/login" class="nav-link active">
                    <i class="fa-solid fa-right-to-bracket" style="color: black"></i>
                  </a>
                </li>
                <li class="nav-item text-center mt-2">
                  <a href="/signup" class="nav-link">
                    <i class="fa-solid fa-user-plus" style="color: black"></i>
                  </a>
                </li>
                <% } %>
          </ul>
        </div>
      </div>
    </nav>
  </header>


  <!---- breadcrumbs ---->
  <div class="container-fluid">
    <div class="row justify-content-end" style="background-color: #e2e2e2;height: 30px;">

      <div class="col-7 col-md-7 col-lg-9">
        <h5 style="color: black;">SHOP</h5>
      </div>

      <div class="col-5 col-md-4 col-lg-2">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">

            <li class="breadcrumb-item " aria-current="page">
              <a href="/" style="text-decoration: none;color: black;">Home</a>
            </li>

            <li class="breadcrumb-item active" aria-current="page">
              login
            </li>

          </ol>
        </nav>
      </div>
    </div>

  </div>


  <form class="input-group mt-3" id="searchForm" style="box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);"
    onsubmit="redirectToSearch(event)">
    <input type="text" name="searchQuery" class="form-control" placeholder="Search for product" required>
    <button type="submit" class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></button>
  </form>


  <!---- main content ---->
  <div class="container">

    <!----- main row , col ----->
    <div class="row">

      <!---- toggle icon ---->
      <div class="toggle-icon d-block d-md-none mt-4">
        <button class="btn btn-primary mx-2" type="button" id="filterToggleButton"
          style="font-size: 20px;width: 190px;background-color: black;color: white;border: 1px solid black;border-radius: 5px;">
          <i class="fa-solid fa-filter mx-3"></i>Filter
        </button>
      </div>

      <div class=" col-md-4 col-lg-2 mt-4">

        <div id="filterSection" class="filter-section">
          <!-- <div class="card card-body"> -->


          <!---- filter row , col ---->
          <div class="row mt-3">
            <div class="col-12 mb-3">
              <div class="card">
                <h3 class="card-header">Category</h3>
                <div class="card-body">

                  <form>

                    <% for(let i=0; i<categories.length; i++) { %>
                      <div class="form-group mt-3 mb-3">
                        <input type="radio" class="custom-control-input form-check-input" name="category"
                          id="<%= categories[i].categoryName %>" value="<%= categories[i].categoryName %>" />
                        <label class="custom-control-label" for="<%= categories[i].categoryName %>">
                          <%= categories[i].categoryName %>
                        </label>
                      </div>
                      <% } %>

                  </form>

                </div>
              </div>
            </div>


            <div class="col-12 my-3">
              <div class="card">
                <h3 class="card-header">Price</h3>
                <div class="card-body">

                  <form>
                    <div class="form-group">
                      <div class="custom-control custom-radio me-sm-2 form-check">
                        <input type="radio" class="custom-control-input form-check-input" id="250-500" name="price"
                          value="250-500">
                        <label class="custom-control-label" for="250-500">250 - 500</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="custom-control custom-radio me-sm-2 form-check">
                        <input type="radio" class="custom-control-input form-check-input" id="500-1500" name="price"
                          value="500-1500">
                        <label class="custom-control-label" for="500-1500">500 - 1500</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="custom-control custom-radio me-sm-2 form-check">
                        <input type="radio" class="custom-control-input form-check-input" id="1500-2500" name="price"
                          value="1500-2500">
                        <label class="custom-control-label" for="1500-2500">1500 - 2500</label>
                      </div>
                    </div>
                  </form>

                </div>
              </div>
            </div>


            <!----- sort by ----->
            <div class="col-12 my-3">
              <div class="card">
                <h3 class="card-header">Srot By</h3>
                <div class="card-body">

                  <form>
                    <div class="form-group">
                      <div class="custom-control custom-radio me-sm-2 form-check">
                        <input type="radio" class="custom-control-input form-check-input" id="low to heigh" name="sort"
                          value="low to heigh">
                        <label class="custom-control-label" for="low to heigh"><strong>Price:</strong> low to
                          heigh</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="custom-control custom-radio me-sm-2 form-check">
                        <input type="radio" class="custom-control-input form-check-input" id="heigh to low" name="sort"
                          value="heigh to low">
                        <label class="custom-control-label" for="heigh to low<"><strong>Price:</strong> heigh to
                          low</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="custom-control custom-radio me-sm-2 form-check">
                        <input type="radio" class="custom-control-input form-check-input" id="ascending" name="sort"
                          value="ascending">
                        <label class="custom-control-label" for="ascending"><strong>Name:</strong> ascending</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="custom-control custom-radio me-sm-2 form-check">
                        <input type="radio" class="custom-control-input form-check-input" id="descending" name="sort"
                          value="descending">
                        <label class="custom-control-label" for="descending"><strong>Name:</strong> descending</label>
                      </div>
                    </div>
                  </form>

                </div>
              </div>
            </div>


            <!-- Apply Filter Button -->
            <div class="section d-flex justify-content-center flex-column" style="margin-right: 67px;">
              <div class="d-flex justify-content-center flex-column">
                <button type="button" class="full-width-button" style="font-size: 15px;" id="applyFiltersButton">Apply
                  filters</button>
                <a href="/shop"><button type="button" class="full-width-button mt-2" style="font-size: 15px;">Remove
                    filters</button></a>
              </div>
            </div>

          </div>
          <!-- </div> -->

        </div>
      </div>









      <div class="col-sm-6 col-lg-10 mt-3">

        <!---- product col, row-1 ----->
        <div class="row product-list">
          <% productData.forEach(product=> { %>
            <div class="col-sm-12 col-lg-4 mt-2">

              <div class="card mt-3" style="border: none;">
                <a href="/singleProduct?productId=<%= product._id %>">
                  <img src="/assets/uploadimages/uploads/<%= product.productImage[0] %>" alt="Product Image"
                    class="card-img-top" style="max-width: 100%; height: 350px; object-fit: cover;">
                </a>



                <div class="card-body" style="color: white;background-color: rgb(255, 255, 255);">

                  <!-- <p class="text-muted"><%= product.parentCategory.categoryName %></p> -->
                  <div class="d-flex justify-content-between align-items-center">
                    <p class="text-muted mb-0">
                      <%= product.parentCategory.categoryName %>
                    </p>

                    <% let isInWishlist=false; %>
                      <% wishlist.forEach(item=> { %>
                        <% if(String(item.productId)===String(product._id)) { %>
                          <% isInWishlist=true; %>
                            <% } %>
                              <% }); %>

                                <% if(isInWishlist) { %>
                                  <a class="wishlist-icon" id="lisIcon">
                                    <i class="fas fa-heart" style="color: red;"></i>
                                  </a>
                                  <% } else { %>
                                    <a class="wishlist-icon" onclick="addItemToWishlist(event,'<%= product._id %>')">
                                      <i class="fas fa-heart"></i>
                                    </a>
                                    <% } %>

                  </div>

                  <h5 class="product-name" style="color: black;">
                    <%= product.productName %>
                  </h5>

                  <div style="display: flex;">
                    <% if(product.offerPrice !==null) { %>

                      <span class="text-muted"><strike>₹<%= product.productPrice %></strike></span>
                      <h6 style="color:black;margin-left: 4%;"> ₹<%= product.offerPrice %>
                      </h6>
                      <span style="margin-left: 4%;color: rgb(255, 0, 247);font-weight: bolder;">
                        <%= product.offerApplied %>%
                      </span>
                      <% }else{ %>
                        <h6 style="color:black;margin-left: 4%;"> ₹<%= product.productPrice %>
                        </h6>
                        <% } %>
                  </div>

                  <div class="rating">
                    <% const fullStars=Math.floor(product.averageRating); %>
                      <% const halfStar=product.averageRating % 1 !==0; %>
                        <% const emptyStars=5 - fullStars - (halfStar ? 1 : 0); %>

                          <% for (let i=0; i < fullStars; i++) { %>
                            <i class="fas fa-star" style="color: rgb(255, 204, 0);"></i>
                            <% } %>

                              <% if (halfStar) { %>
                                <i class="fas fa-star-half-alt" style="color: rgb(255, 204, 0);"></i>
                                <% } %>

                                  <% for (let i=0; i < emptyStars; i++) { %>
                                    <i class="far fa-star" style="color: rgb(255, 204, 0);"></i>
                                    <% } %>
                  </div>



                </div>
              </div>
            </div>
            <% }) %>

              <div id="popup-message" class="popup-message">Item added to wishlist</div>

        </div>

        <!------- item addting to list ---->

        <script>
          async function addItemToWishlist(event, productId) {
            event.preventDefault();

            try {
              console.log(productId)
              let response = await fetch(`/wishlist/addItem/${productId}`, {
                method: 'POST'
              })

              const result = await response.json();

              if (!result.success && result.userNotLogged) {
                Swal.fire({
                  title: "You need to login",
                  text: "to create a wishlist",
                  icon: "info",
                  showCancelButton: true,
                  confirmButtonColor: "#3085d6",
                  cancelButtonColor: "#31A94C",
                  confirmButtonText: "Go to login",
                  cancelButtonText: "Back"
                }).then((result) => {
                  if (result.isConfirmed) {
                    window.location.href = '/login'
                  }
                });
                // window.location.href = '/login';
              } else if (result.success) {
                await Swal.fire({
                  title: "Added to wishlist!",
                  icon: "success",
                  showCancelButton: true,
                  confirmButtonColor: "#3085d6",
                  cancelButtonColor: "#31A94C",
                  cancelButtonText: "Continue shopping",
                  confirmButtonText: "Go to wishlist"
                }).then((result) => {
                  if (result.isConfirmed) {
                    window.location.href = '/wishlist';
                  } else {
                    window.location.href = '/shop';
                  }
                });
              } else if (!result.success && result.productAlreadyExist) {
                await Swal.fire({
                  title: "product Already Added to List!",
                  text: "You Cannot add these product to List.",
                  icon: "error",
                  confirmButtonColor: "#3085d6",
                  confirmButtonText: "OK"
                });
              }

            } catch (error) {
              console.error(error.message)
            }

          }
        </script>


        <!---- pagination ---->
        <nav aria-label="pagination">
          <ul class="pagination justify-content-center">
            <li class="page-item <%= currentPage === 1? 'disabled' : '' %>">
              <a onclick="pageClick('<%= currentPage - 1 %>')" class="page-link" aria-label="Previous"
                style="background-color: #295f4e;">
                <span aria-hidden="true" style="color: white;">&laquo;</span>
              </a>
            </li>
            <% for (let i=1; i <=totalPages; i++) { %>
              <li class="page-item <%= currentPage === i? 'active' : '' %>">
                <a onclick="pageClick('<%= i %>')" class="page-link"
                  style="background-color: rgb(255, 255, 255);color: black;">
                  <%= i %>
                </a>
              </li>
              <% } %>
                <li class="page-item <%= currentPage === totalPages? 'disabled' : '' %>">
                  <a onclick="pageClick('<%= currentPage + 1 %>')" class="page-link" aria-label="Next"
                    style="background-color: #295f4e;">
                    <span aria-hidden="true" style="color: white;">&raquo;</span>
                  </a>
                </li>
          </ul>
        </nav>

        <script>
          function pageClick(page) {
            const currentPage = parseInt(page);
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('page')) {
              urlParams.set('page', currentPage);
            } else {
              urlParams.append('page', currentPage);
            }
            window.location.search = urlParams.toString();
          }
        </script>


      </div>

    </div>
  </div>



  <%- include("../userPartials/footer") %>

    <script>
      const filterDet = '<%- JSON.stringify(queryFilters) %>'
      const parsedFilters = JSON.parse(filterDet)




      const selectedFilters = {}
      let url = `/filterProduct?`;


      const radios = document.querySelectorAll('input[type="radio"]');

      applyFiltersButton.addEventListener('click', async () => {
        radios.forEach(radio => {
          if (radio.checked) {
            const val = radio.id;
            const filterType = radio.name;
            selectedFilters[filterType] = val;
            console.log(filterType);
          }
        });
        console.log('Selected: ', selectedFilters)

        const urlParams = new URLSearchParams(window.location.search);
        const searchQuery = urlParams.get('bySearch');

        let url = `/filterProduct?`;

        if (searchQuery) {
          url += `bySearch=${searchQuery}&`;
        }

        Object.keys(selectedFilters).forEach((filterType, index) => {
          url += `${filterType}=${selectedFilters[filterType]}${index < Object.keys(selectedFilters).length - 1 ? '&' : ''}`;
        });

        console.log(url);
        window.location.href = url;
        // console.log("Heolloe");
      });

      const radioz = document.querySelectorAll('input[type="radio"]');
      if (parsedFilters) {
        radioz.forEach(radio => {
          if (parsedFilters) {
            for (let key in parsedFilters) {
              if (parsedFilters[key] === radio.id) {
                radio.checked = true
              }
            }

          }
        });
      }


      ///search
      let urlSearch = url; // store the current URL

      function redirectToSearch(event) {
        event.preventDefault();
        const searchQuery = document.querySelector('input[name="searchQuery"]').value;
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('bySearch', searchQuery); // update the query string
        const newUrl = `${urlSearch.split('?')[0]}?${urlParams.toString()}`;
        console.log('serach Url: ', newUrl); // reconstruct the URL
        window.location.href = newUrl;
        console.log(searchQuery);
      }
      window.addEventListener('load', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const searchQuery = urlParams.get('bySearch');
        if (searchQuery) {
          document.querySelector('input[name="searchQuery"]').value = searchQuery;
        }
      });
    </script>



    <!-- JavaScript -->
    <script>

      //filter toggle button
      document.addEventListener('DOMContentLoaded', function () {
        const filterToggleButton = document.getElementById('filterToggleButton');
        const filterSection = document.getElementById('filterSection');

        filterToggleButton.addEventListener('click', function () {
          if (window.getComputedStyle(filterSection).display === 'none') {
            filterSection.style.display = 'block';
          } else {
            filterSection.style.display = 'none';
          }
        });
      });


      //side toggle view
      document.addEventListener('DOMContentLoaded', function () {
        const filterToggleButton = document.getElementById('filterToggleButton');
        const filterSection = document.getElementById('filterSection');

        filterToggleButton.addEventListener('click', function () {
          filterSection.classList.toggle('visible');
        });
      });


      //search bar size
      function adjustSearchBar() {
        const searchForm = document.getElementById('searchForm');

        if (window.matchMedia("(max-width: 767.98px)").matches) {
          searchForm.style.width = '70%';
          searchForm.style.marginLeft = '25%';
        } else {
          searchForm.style.width = '30%';
          searchForm.style.marginLeft = '70%';
        }
      }

      document.addEventListener('DOMContentLoaded', function () {
        adjustSearchBar(); // Adjust on initial load
        window.addEventListener('resize', adjustSearchBar); // Adjust on window resize
      });

      // function redirectToSearch(event) {
      //   event.preventDefault();
      //   // Add your redirection logic here
      // }


    </script>


</body>

</html>